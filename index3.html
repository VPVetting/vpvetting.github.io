<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <title>Plot Listing HTML5 Website Template</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css" />
    <link rel="stylesheet" href="assets/css/templatemo-plot-listing.css" />
    <link rel="stylesheet" href="assets/css/animated.css" />
    <link rel="stylesheet" href="assets/css/owl.css" />
    <!--

TemplateMo 564 Plot Listing

https://templatemo.com/tm-564-plot-listing

-->
  </head>

  <body>
    <!-- ***** Preloader Start ***** -->
    <div id="js-preloader" class="js-preloader">
      <div class="preloader-inner">
        <span class="dot"></span>
        <div class="dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
    <!-- ***** Preloader End ***** -->

    <div class="main-banner">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="top-text header-text">
              <h2>VR Privacy Policy Analysis</h2>
            </div>
          </div>
          <div class="col-lg-12 align-self-center">
            <div class="search-box">
              <div class="row">
                <div class="col-lg-4 align-self-center">
                  <fieldset>
                    <select
                      name="manufter_select"
                      class="form-select"
                      aria-label="Area"
                      id="manufter"
                      onchange="select_manu()"
                    >
                      <option value="" disabled selected hidden>
                        --Please select Manufacturer--
                      </option>
                      <option value="Manufacturer1">test_manufter0</option>
                      <option value="Manufacturer2">test_manufter1</option>
                      <option value="Manufacturer3">test_manufter2</option>
                      <option value="Manufacturer4">test_manufter3</option>
                    </select>
                  </fieldset>
                </div>

                <div class="col-lg-4 align-self-center">
                  <fieldset>
                    <select
                      name="gamename_select"
                      class="form-select"
                      aria-label="Default select example"
                      id="gamename"
                      onchange="select_name()"
                    >
                      <option value="" disabled selected hidden>
                        --Please select GameName--
                      </option>
                    </select>
                  </fieldset>
                </div>
                <div class="col-lg-4 align-self-center">
                  <fieldset>
                    <button class="main-button" onclick="query('vr_pps',1)">
                      <i class="fa fa-search"></i> Query
                    </button>
                  </fieldset>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="popular-categories">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="section-heading">test</div>
          </div>
        </div>
      </div>
    </div>
    <footer>
      <div class="container"></div>
    </footer>

    <!-- Scripts -->
    <script>
      //获取所有input盒子
      const inputs = document.querySelectorAll("select");
      for (i = 0; i < inputs.length; i++) {}
      let tbody = document.getElementsByClassName("section-heading")[0]; //获取元素
      console.log(tbody);
      let bool = false; //控制更新阀门
      let sid = ""; //存储 key值
      var vrpp_lis = [
        {
          id: 0,
          manufter: "test_manufter0",
          gamename: "test_name0",
          version: "test_version0",
          pp: "test_pp0",
        },
        {
          id: 1,
          manufter: "test_manufter1",
          gamename: "test_name1",
          version: "test_version1",
          pp: "test_pp1",
        },
        {
          id: 2,
          manufter: "test_manufter2",
          gamename: "test_name2",
          version: "test_version2",
          pp: "test_pp2",
        },
        {
          id: 3,
          manufter: "test_manufter3",
          gamename: "test_name3",
          version: "test_version3",
          pp: "test_pp3",
        },
        {
          id: 4,
          manufter: "test_manufter4",
          gamename: "test_name4",
          version: "test_version4",
          pp: "test_pp4",
        },
        {
          id: 5,
          manufter: "test_manufter5",
          gamename: "test_name5",
          version: "test_version5",
          pp: "test_pp5",
        },
        {
          id: 6,
          manufter: "test_manufter6",
          gamename: "test_name6",
          version: "test_version6",
          pp: "test_pp6",
        },
        {
          id: 7,
          manufter: "test_manufter7",
          gamename: "test_name7",
          version: "test_version7",
          pp: "test_pp7",
        },
        {
          id: 8,
          manufter: "test_manufter8",
          gamename: "test_name8",
          version: "test_version8",
          pp: "test_pp8",
        },
        {
          id: 9,
          manufter: "test_manufter9",
          gamename: "test_name9",
          version: "test_version9",
          pp: "test_pp9",
        },
        {
          id: 10,
          manufter: "test_manufter10",
          gamename: "test_name10",
          version: "test_version10",
          pp: "test_pp10",
        },
        {
          id: 11,
          manufter: "test_manufter11",
          gamename: "test_name11",
          version: "test_version11",
          pp: "test_pp11",
        },
        {
          id: 12,
          manufter: "test_manufter12",
          gamename: "test_name12",
          version: "test_version12",
          pp: "test_pp12",
        },
        {
          id: 13,
          manufter: "test_manufter13",
          gamename: "test_name13",
          version: "test_version13",
          pp: "test_pp13",
        },
        {
          id: 14,
          manufter: "test_manufter14",
          gamename: "test_name14",
          version: "test_version14",
          pp: "test_pp14",
        },
      ];

      //打开数据库
      function openDB(dbname, version) {
        let db = null;
        let req = indexedDB.open(dbName, version);

        return new Promise((resolve, reject) => {
          req.onerror = () => {
            console.log("Error!");
            reject("Error!");
          };
          req.onsuccess = (e) => {
            db = e.target.result;
            console.log("Open Successfully");
            resolve(db);
          };
          req.onupgradeneeded = (e) => {
            db = e.target.result;
            if (!db.objectStoreNames.contains("vr_pps")) {
              //返回对象仓库
              let store = db.createObjectStore("vr_pps", {
                keyPath: "id",
                autoIncrement: true,
              });
              //创建索引
              store.createIndex("id", "id", { unique: true });
              store.createIndex("manufter", "manufter", { unique: false });
              store.createIndex("gamename", "gamename", { unique: false });
              store.createIndex("version", "version", { unique: false });
              store.createIndex("pp", "pp", { unique: false });
              console.log("Create Successfully");
            }
          };
        });
      }
      let version = 1;
      let dbName = "vr_pps";
      let db;
      let manu_res = null;
      result_game = null;

      //初始化DB，写入VR_PP数据信息
      function initDB(dbName, version) {
        let result = openDB(dbName, version).then((db) => {
          let request = db.transaction(dbName, "readwrite").objectStore(dbName);
          for (i = 0; i < vrpp_lis.length; ++i) {
            result = request.add(vrpp_lis[i]);
            result.onsuccess = function (e) {
              console.log("Add Successfully!");
            };
            result.onerror = function (e) {
              console.log("Fail to add!");
            };
          }
          db.close();
        });
      }

      function select_manu() {
        var nSel = document.getElementById("manufter");
        index = nSel.selectedIndex;
        console.log(index);
        var selected_manu = nSel[index].text;
        console.log(selected_manu);
        let request = openDB(dbName, version).then((db) => {
          let store = db.transaction(dbName, "readwrite").objectStore(dbName);
          let index = store.index("manufter");
          let getAllrequest = index.getAll(selected_manu);
          //游标请求成功
          var gamename_sel = document.getElementById("gamename");
          gamename_sel.innerHTML = `<option value="" disabled selected hidden>
            --Please select GameName--
          </option>`;
          getAllrequest.onsuccess = () => {
            result = getAllrequest.result;
            manu_res = result;
            for (i = 0; i < result.length; ++i) {
              gamename_sel.innerHTML += `
              <option value="${result[i].gamename}">${result[i].gamename}</option>
              `;
            }
          };
        });
      }
      function select_name() {
        var nSel = document.getElementById("gamename");
        index = nSel.selectedIndex;
        var selected_game = nSel[index].text;
        if (manu_res != null) {
          result_game = manu_res[index - 1];
        }
      }
      // 查询vr_pp
      function query(dbName, version) {
        tbody.innerHTML = ``;
        if (result_game != null) {
          console.log("here!");
          tbody.innerHTML += `<h2>${result_game.gamename}</h2>
          <h6>${result_game.manufter}</h6>`;
        }
      }
      initDB(dbName, version);
    </script>
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/owl-carousel.js"></script>
    <script src="assets/js/animation.js"></script>
    <script src="assets/js/imagesloaded.js"></script>
    <script src="assets/js/custom.js"></script>
  </body>
</html>
